{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["FileSystemCache","memoryCache","tagsManifest","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","maxMemoryCacheSize","LRUCache","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","tagsManifestPath","path","join","loadTagsManifest","parse","readFileSync","toString","err","version","items","setTags","key","tags","tag","keys","includes","push","mkdir","dirname","writeFile","console","warn","revalidateTag","revalidatedAt","Date","now","get","fetchCache","process","env","NEXT_RUNTIME","filePath","getFsPath","pathname","fileData","readFile","mtime","stat","meta","replace","cacheEntry","lastModified","getTime","headers","status","_","isAppPath","parsedData","set","cacheTags","tagsHeader","split","getDerivedTags","derivedTags","startsWith","pathnameParts","i","curPathname","slice","isStale","some","innerData","wasRevalidated","undefined","htmlPath"],"mappings":"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"}